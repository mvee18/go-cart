* Call signature:
  - go-cart <geometry file> <# go routines>? <# derivative>?
    
* TODO GET RID OF DUPLICATES 1,2,1 = 2,1,1 = 112
  - tried fixing with i <= j <= k but didnt work so reverted
  - think more

* TODO likely problem with math in third derivatives/wrong ordering
  - I think emphasis on wrong ordering will reveal the math but maybe other way around

* TODO checkpoint system - resume from incomplete run
  - +see below, would need to write fcs as we go?+
  - +alternatively have to dump joblist or something+
  - marshal joblist into json to dump, unmarshal to restore
    - just need to add a check that job.Result != 0 in the main loop, skip if it's nonzero
  - commandline option to resume job

* TODO Delete files after reading
  - this is back to not working since it was making too many syscalls
  - try keeping garbage list and tacking some on to every pbs job
    - hopefully deletes on compute node, saving me resources on head

* TODO check for already calculated 2nd derivatives in 4ths
  - I think the ordering in BuildJobList is conducive for this already
    - just see if fcs[i,j] exists and use that as Job.Result in 4ths
      - This is the problem; not saving to fcs until all jobs are done
  - every case but all different uses 2nds so this should be real savings
  - job.Result = &fcs[i,j] ? 
    - doesn't work without making Result *float64
    - and then that doesnt work with assigning numbers to it
  - Promise struct with indices of fcs[i,j] to be read at end
    #+BEGIN_SRC go
    type Promise interface {
	Result([][]float64) float64
    }

    type Fetch struct {
	Index [2]int
    }

    func (f Fetch) Result(src [][]float64) float64 {
	// fetch the result from src slice
	return src[f.Index[0]][f.Index[1]]
    }

    type Give struct {
	Value float64
    }

    func (g Give) Result(_ [][]float64) float64 {
	return g.Value
    }
    #+END_SRC
    
* TODO fix counting, probably have to use a global variable or something

* Should first derivatives in thirds be zero?
    
* TODO input file with 
** Alternatively config file like Judd suggested
  - geometry
  - number of concurrent jobs
  - when to write checkpoints
  - molpro job information

* TODO investigate alternate calculation schemes to minimize floating point error
  - Library/Floats.pdf
   
* TODO eland compatibility - for more threads

* Should probably be using the same seed for the hashnames, look into this
  - right now just hoping they arent randomly the same?
  
* Advice from irc
  <dominikh> anyway, NumGoroutine isn't really a useful metric for avoiding
  hitting the limit. I'd just have a semaphore (easiest implemented
  as a buffered channel). acquire before spawning a goroutine,
  release when a goroutine returns, and hope things work out
    
* if I need more signals just use combinations of them
  - two signals gives 900 unique combos compared to 30 of one

* zero values below some threshold - hold off for now, see later 

* DONE option for different derivative levels
** DONE test this

* DONE THOROUGHLY RETHINK RETRIES -> I've been calling it twice if it fails to read
** Removed
  - no I havent, the qsubmit one was local and that's the only one causing trouble
  - probably just forget about it, everything should work eventually <- trying this now

* DONE figure out how higher order derivatives are written in output
  - tentatively done

* DONE experiment with no thread locking
  - I think it should help to hold a thread for reading/submitting which can run into resouce problems
    - otherwise when I sleep to wait for resources, something else will use the resources
  - but this might not be right
  - if anything take it off reading, probably more necessary for submit
      
* Maple benchmarking data for second derivatives 
  - all locks, 9 workers was fastest
  - 11 workers with read locks is fastest now
  - Working hypothesis:
    - Read locks speed it up - not sleeping while thread locked
    - Submit locks slow it down - sleeping while thread locked
    - Optimal workers is in the range [9,11]
  - differences of 28e-10 in many results throughout testing, sometimes twice that
|-----------------+--------+------------+-----------+------------+--------------|
|                 |        | Both Locks | No Locks  | Read Locks | Submit Locks |
|-----------------+--------+------------+-----------+------------+--------------|
| Trial           | Repeat | Time       | Time      | Time       | Time         |
|-----------------+--------+------------+-----------+------------+--------------|
| 2D - 16 workers |      1 | 11m13.796s |           |            |              |
|                 |      2 | 12m53.310s |           |            |              |
|                 |      3 | crash      |           |            |              |
|-----------------+--------+------------+-----------+------------+--------------|
| 2D - 12 workers |      1 | 4m23.100s  | 8m15.264s | 4m38.532s  | 11m44.230s   |
|                 |      2 | 6m18.229s  | 7m2.754s  | 4m16.705s  | 5m52.712s    |
|                 |      3 | 5m14.072s  | 6m9.490s  | 8m25.406s  | 5m2.215s     |
|-----------------+--------+------------+-----------+------------+--------------|
| 2D - 11 workers |      1 | 4m52.667s  | 4m56.138s | 4m1.981s   | 4m46.356s    |
|                 |      2 | 5m38.494s  | 5m34.129s | 3m54.353s  | 6m48.663s    |
|                 |      3 | 6m22.455s  | 4m33.178s | 4m48.952s  | 5m41.851s    |
|-----------------+--------+------------+-----------+------------+--------------|
| 2D - 10 workers |      1 | 4m26.072s  | 6m19.906s | 5m9.203s   | 5m47.458s    |
|                 |      2 | 4m28.380s  | 5m24.394s | 5m13.700s  | 5m11.124s    |
|                 |      3 | 6m28.970s  | 4m23.665s | 4m22.972s  | 5m29.700s    |
|-----------------+--------+------------+-----------+------------+--------------|
| 2D - 9 workers  |      1 | 4m45.994s  | 5m27.572s | 4m35.968s  | 5m40.977s    |
|                 |      2 | 4m41.724s  | 4m57.922s | 4m34.347s  | 5m38.867s    |
|                 |      3 | 4m40.645s  | 6m57.403s | 4m40.101s  | 5m39.927s    |
|-----------------+--------+------------+-----------+------------+--------------|
| 2D - 8 workers  |      1 | 5m7.947s   | 5m15.907s | 5m20.310s  | 6m35.837s    |
|                 |      2 | 5m7.585s   | 5m14.423s | 5m23.689s  | 6m9.979s     |
|                 |      3 | 5m7.317s   | 5m2.927s  | 5m30.961s  | 6m11.103s    |
|-----------------+--------+------------+-----------+------------+--------------|
| 2D - 4 workers  |      1 | 9m39.824s  |           |            |              |
|                 |      2 | 9m44.195s  |           |            |              |
|                 |      3 | 9m34.168s  |           |            |              |
|-----------------+--------+------------+-----------+------------+--------------|
